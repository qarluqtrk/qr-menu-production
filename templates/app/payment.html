<!DOCTYPE html>
{% load static %}
<html lang="en">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

    <link rel="icon" href='/static/assets/images/afc-logo.png' type="image/x-icon"/>
    <title>AFC</title>
    <link rel="apple-touch-icon" href='/static/assets/images/afc-logo.png'/>
    <meta name="theme-color" content="#122636"/>
    <meta name="apple-mobile-web-app-capable" content="yes"/>
    <meta name="apple-mobile-web-app-status-bar-style" content="black"/>
    <meta name="apple-mobile-web-app-title" content="fuzzy"/>
    <meta name="msapplication-TileImage" content='/static/assets/images/afc-logo.png'/>
    <meta name="msapplication-TileColor" content="#FFFFFF"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>

    <!--Google font-->
    <link rel="preconnect" href="https://fonts.googleapis.com"/>
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@100;200;300;400;500;600;700;800;900&display=swap"
          rel="stylesheet"/>

    <!-- iconsax css -->
    <link rel="stylesheet" href='/static/assets/css/vendors/iconsax.css'/>
    <!-- bootstrap css -->
    <link rel="stylesheet" id="rtl-link" href='/static/assets/css/vendors/bootstrap.min.css'/>
    <!-- Theme css -->
    <link rel="stylesheet" id="change-link" href='/static/assets/css/style.css'/>
</head>

<body>
<!-- header start -->
<header class="section-t-space">
    <div class="custom-container">
        <div class="header-panel">
            <a href="payment.html">
                <i class="iconsax back-btn" data-icon="arrow-left"></i>
            </a>
            <h3>Add New Card</h3>
        </div>
    </div>
</header>
<!-- header end -->

<!-- card form section start -->
<section class="section-b-space">
    <div class="custom-container">

        <form id="paymentForm" class="address-form" action="{% url 'payment' %}" method="post" target="_blank"
              onsubmit="formatExpiryDate()">
            {% csrf_token %}
            <div class="form-group">
                <label class="form-label">Karta Raqam</label>
                <div class="form-input mb-3">
                    <input type="text" id="cardNumberInput" name="card_number" class="form-control"
                           placeholder="0000 0000 0000 0000"
                           oninput="formatCardNumber()" onkeypress="validateCardNumber(event)" maxlength="19" required/>
                </div>
            </div>

            <div class="row">
                <div class="form-group">
                    <label class="form-label">Exp. Date</label>
                    <div class="form-input mb-3">
                        <input type="text" id="expiryDateInput" name="expiry_date" class="form-control"
                               placeholder="mm/yy"
                               oninput="formatExpiryDate()" onkeypress="validateExpiryDate(event)" pattern="\d{2}/\d{2}"
                               required/>
                    </div>
                </div>
            </div>
            <input type="hidden" name="step" value="1">

            <button type="submit" class="btn theme-btn mt-5 w-100">Yuborish</button>
        </form>
        <div class="otp-verification" id="otp-verify" style="display: none">
            <h4>We have sent a verification code to</h4>
            <h4 id="smsnum" class="otp-number mt-2">+91 635 546 23098</h4>
        </div>
        <form id="otpForm" class="otp-form" action="{% url 'payment' %}" method="post" hidden>
            {% csrf_token %}
            <div class="form-input dark-border-gradient">
                <input type="number" class="form-control active" placeholder="0" id="five1"
                       onkeyup="onKeyUpEvent(1, event)" onfocus="onFocusEvent(1)"/>
            </div>
            <div class="form-input dark-border-gradient">
                <input type="number" class="form-control" placeholder="0" id="five2" onkeyup="onKeyUpEvent(2, event)"
                       onfocus="onFocusEvent(2)"/>
            </div>
            <div class="form-input dark-border-gradient">
                <input type="number" class="form-control" placeholder="0" id="five3" onkeyup="onKeyUpEvent(3, event)"
                       onfocus="onFocusEvent(3)"/>
            </div>
            <div class="form-input dark-border-gradient">
                <input type="number" class="form-control" placeholder="0" id="five4" onkeyup="onKeyUpEvent(4, event)"
                       onfocus="onFocusEvent(4)"/>
            </div>
            <div class="form-input dark-border-gradient">
                <input type="number" class="form-control" placeholder="0" id="five5" onkeyup="onKeyUpEvent(5, event)"
                       onfocus="onFocusEvent(5)"/>
            </div>
            <div class="form-input dark-border-gradient">
                <input type="number" class="form-control" placeholder="0" id="five6" onkeyup="onKeyUpEvent(6, event)"
                       onfocus="onFocusEvent(6)"/>
            </div>
            <input type="hidden" name="step" value="2">
            <input id="otpInput" type="hidden" name="otp" value="0">
        </form>

    </div>
</section>
<!-- card form section end -->
<!-- card form section start -->

<!-- iconsax js -->
<script src="{% static 'assets/js/iconsax.js' %}"></script>

<!-- bootstrap js -->
<script src="{% static 'assets/js/bootstrap.bundle.min.js' %}"></script>

<!-- script js -->
<script src="{% static 'assets/js/script.js' %}"></script>
<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
<script>
    $(function () {
        $('#paymentForm').on('submit', function (event) {
            event.preventDefault();
            console.log($(this).serialize())
            $.ajax({
                url: '/payment/',
                type: 'POST',
                action: 'pay',
                data: $(this).serialize() ,
                dataType: 'json',
                success: function (response) {
                    if (response.success) {
                        console.log(response.success);
                        $('#paymentForm').hide();
                        $('#smsnum').text(response['phone']);
                        $('#otp-verify').show();
                        $('#otpForm').prop('hidden', false);
                    }else {
                        window.alert("Ma'lumot xato kiritildi.Iltimos qayta kiriting !");
                    }

                },
                error:function (response){
                        window.alert("Ichki xatolik sodir bo'ldi !");
                }
            });
        });
    });
</script>
<script src="{% static 'assets/js/otp.js' %}"></script>
</body>
</html>
